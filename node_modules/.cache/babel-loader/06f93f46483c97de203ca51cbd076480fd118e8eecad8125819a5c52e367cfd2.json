{"ast":null,"code":"import React,{useEffect}from\"react\";//\nimport Preloader from\"../includes/preloader\";// css\nimport\"../media/css/page/dwe.css\";import\"../media/css/page/deposit.css\";// components\nimport TransactionHistory from\"../components/transaction.history\";import{I18nText}from\"../components/i18nText\";//\nimport{TonConnectButton,useTonAddress,useTonConnectUI}from\"@tonconnect/ui-react\";import config from\"../config\";import axios from\"axios\";import ShowPopup from\"../ShowPopup\";import generatedWallet from\"../api/generatedWallet\";import paymentChecker from\"../api/paymentChecker\";import getPremuimCoinsMarket from\"../api/getPremuimCoinsMarket\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const PageDeposit=()=>{const address=useTonAddress();const[tonConnectUI,setOptions]=useTonConnectUI();const[generatedAddress,setGeneratedAddress]=React.useState(\"\");const[calculatedValue,setCalculatedValue]=React.useState(0);const[isLoading,setIsLoading]=React.useState(false);const[coins,setCoins]=React.useState([]);const makeTransaction=async()=>{setIsLoading(true);if(address!=null&&generatedAddress!=null&&calculatedValue!=0){const transaction={validUntil:Math.floor(new Date()/1000)+360,messages:[{address:generatedAddress,// destination address\namount:calculatedValue*1000000000//Toncoin in nanotons\n}]};await tonConnectUI.sendTransaction(transaction);setTimeout(async()=>{let res=await paymentChecker(calculatedValue*1000000000);console.log(res);if(res.status===400){ShowPopup(\"DUR поступят вам на счёт в ближайшее время\",\"Транзакция\");}},2000);}setIsLoading(false);};useEffect(()=>{const getGenWallet=async()=>{let res=await generatedWallet();if(res!=null){console.log(res);setGeneratedAddress(res);}};const getPremuimCoins=async()=>{let res=await getPremuimCoinsMarket();if(res!=null){setCoins(res);}};const addWallet=async()=>{try{await axios.post(config.url+\"/users/tgWallet\",{tgWallet:address},{headers:{\"Access-Control-Expose-Headers\":\"X-Session\",\"X-Session\":localStorage.getItem(\"session_key\")}}).then(res=>{localStorage.setItem(\"session_key\",res.headers.get(\"X-Session\"));}).catch(e=>{localStorage.setItem(\"session_key\",e.response.headers.get(\"X-Session\"));});}catch(e){ShowPopup(e.response.data,\"Error\");}};getGenWallet();getPremuimCoins();if(address){addWallet();}},[address]);return/*#__PURE__*/_jsxs(\"section\",{className:\"page dwe deposit pb-80\",children:[/*#__PURE__*/_jsx(Preloader,{}),/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"wrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"page_title\",children:[/*#__PURE__*/_jsx(\"h1\",{children:/*#__PURE__*/_jsx(I18nText,{path:\"deposit_title\"})}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(I18nText,{path:\"deposit_desc\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"ton_wallet\",style:{display:\"flex\",justifyContent:\"center\"},children:/*#__PURE__*/_jsx(TonConnectButton,{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"choose\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[/*#__PURE__*/_jsx(I18nText,{path:\"choose_amount\"}),\":\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"list\",children:coins.map((coin,index)=>/*#__PURE__*/_jsxs(_Fragment,{children:[\" \",/*#__PURE__*/_jsx(\"input\",{type:\"radio\",id:\"v\"+index,name:\"choose\"}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"v\"+index,onClick:()=>setCalculatedValue(coin.priceInTON),children:[coin.premiumAmount,\"DUR\"]})]}))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"convert\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[/*#__PURE__*/_jsx(I18nText,{path:\"conversion_rate\"}),\":\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"list\",children:/*#__PURE__*/_jsx(\"span\",{children:\"1 TON = 100 DUR\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pay\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[/*#__PURE__*/_jsx(I18nText,{path:\"you_will_pay\"}),\":\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"list\",children:/*#__PURE__*/_jsxs(\"span\",{children:[calculatedValue,\" TON\"]})})]}),/*#__PURE__*/_jsx(TransactionHistory,{}),/*#__PURE__*/_jsx(\"div\",{className:\"bar_btn\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn_submit\",type:\"submit\",disabled:isLoading,onClick:makeTransaction,children:/*#__PURE__*/_jsx(I18nText,{path:isLoading?\"await_btn\":\"purchase_btn\"})})})]})})]});};export default PageDeposit;","map":{"version":3,"names":["React","useEffect","Preloader","TransactionHistory","I18nText","TonConnectButton","useTonAddress","useTonConnectUI","config","axios","ShowPopup","generatedWallet","paymentChecker","getPremuimCoinsMarket","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","PageDeposit","address","tonConnectUI","setOptions","generatedAddress","setGeneratedAddress","useState","calculatedValue","setCalculatedValue","isLoading","setIsLoading","coins","setCoins","makeTransaction","transaction","validUntil","Math","floor","Date","messages","amount","sendTransaction","setTimeout","res","console","log","status","getGenWallet","getPremuimCoins","addWallet","post","url","tgWallet","headers","localStorage","getItem","then","setItem","get","catch","e","response","data","className","children","path","style","display","justifyContent","map","coin","index","type","id","name","htmlFor","onClick","priceInTON","premiumAmount","disabled"],"sources":["C:/Users/smeno/OneDrive/Рабочий стол/dur/src/pages/deposit.jsx"],"sourcesContent":["import React, { useEffect } from \"react\";\r\n//\r\nimport Preloader from \"../includes/preloader\";\r\n// css\r\nimport \"../media/css/page/dwe.css\";\r\nimport \"../media/css/page/deposit.css\";\r\n// components\r\nimport TransactionHistory from \"../components/transaction.history\";\r\nimport { I18nText } from \"../components/i18nText\";\r\n//\r\nimport {\r\n  TonConnectButton,\r\n  useTonAddress,\r\n  useTonConnectUI,\r\n} from \"@tonconnect/ui-react\";\r\nimport config from \"../config\";\r\nimport axios from \"axios\";\r\nimport ShowPopup from \"../ShowPopup\";\r\nimport generatedWallet from \"../api/generatedWallet\";\r\nimport paymentChecker from \"../api/paymentChecker\";\r\nimport getPremuimCoinsMarket from \"../api/getPremuimCoinsMarket\";\r\n\r\nconst PageDeposit = () => {\r\n  const address = useTonAddress();\r\n  const [tonConnectUI, setOptions] = useTonConnectUI();\r\n  const [generatedAddress, setGeneratedAddress] = React.useState(\"\");\r\n  const [calculatedValue, setCalculatedValue] = React.useState(0);\r\n  const [isLoading, setIsLoading] = React.useState(false);\r\n  const [coins, setCoins] = React.useState([]);\r\n\r\n  const makeTransaction = async () => {\r\n    setIsLoading(true);\r\n    if (address != null && generatedAddress != null && calculatedValue != 0) {\r\n      const transaction = {\r\n        validUntil: Math.floor(new Date() / 1000) + 360,\r\n        messages: [\r\n          {\r\n            address: generatedAddress, // destination address\r\n            amount: calculatedValue * 1000000000, //Toncoin in nanotons\r\n          },\r\n        ],\r\n      };\r\n\r\n      await tonConnectUI.sendTransaction(transaction);\r\n\r\n      setTimeout(async () => {\r\n        let res = await paymentChecker(calculatedValue * 1000000000);\r\n        console.log(res);\r\n        if (res.status === 400) {\r\n          ShowPopup(\"DUR поступят вам на счёт в ближайшее время\", \"Транзакция\");\r\n        }\r\n      }, 2000);\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    const getGenWallet = async () => {\r\n      let res = await generatedWallet();\r\n      if (res != null) {\r\n        console.log(res);\r\n        setGeneratedAddress(res);\r\n      }\r\n    };\r\n    const getPremuimCoins = async () => {\r\n      let res = await getPremuimCoinsMarket();\r\n      if (res != null) {\r\n        setCoins(res);\r\n      }\r\n    };\r\n    const addWallet = async () => {\r\n      try {\r\n        await axios\r\n          .post(\r\n            config.url + \"/users/tgWallet\",\r\n            {\r\n              tgWallet: address,\r\n            },\r\n            {\r\n              headers: {\r\n                \"Access-Control-Expose-Headers\": \"X-Session\",\r\n                \"X-Session\": localStorage.getItem(\"session_key\"),\r\n              },\r\n            }\r\n          )\r\n          .then((res) => {\r\n            localStorage.setItem(\"session_key\", res.headers.get(\"X-Session\"));\r\n          })\r\n          .catch((e) => {\r\n            localStorage.setItem(\r\n              \"session_key\",\r\n              e.response.headers.get(\"X-Session\")\r\n            );\r\n          });\r\n      } catch (e) {\r\n        ShowPopup(e.response.data, \"Error\");\r\n      }\r\n    };\r\n\r\n    getGenWallet();\r\n    getPremuimCoins();\r\n    if (address) {\r\n      addWallet();\r\n    }\r\n  }, [address]);\r\n\r\n  return (\r\n    <section className=\"page dwe deposit pb-80\">\r\n      <Preloader />\r\n      <div className=\"container\">\r\n        {/* form */}\r\n        <div className=\"wrap\">\r\n          <div className=\"page_title\">\r\n            <h1>\r\n              <I18nText path=\"deposit_title\" />\r\n            </h1>\r\n            <p>\r\n              <I18nText path=\"deposit_desc\" />\r\n            </p>\r\n          </div>\r\n          {/* ton_adress */}\r\n          <div\r\n            className=\"ton_wallet\"\r\n            style={{ display: \"flex\", justifyContent: \"center\" }}\r\n          >\r\n            {/* <button className=\"ton_copy_btn\">\r\n              <p>Eqz...wzcx</p>\r\n              <small>TON Adress</small>\r\n            </button> */}\r\n            {/* <button type=\"button\" className=\"connect_btn\">\r\n              <I18nText path=\"connect_wallet\" />\r\n            </button> */}\r\n            <TonConnectButton />\r\n          </div>\r\n          {/* choose */}\r\n          <div className=\"choose\">\r\n            <h2>\r\n              <I18nText path=\"choose_amount\" />:\r\n            </h2>\r\n            <div className=\"list\">\r\n              {coins.map((coin, index) => (\r\n                <>\r\n                  {\" \"}\r\n                  <input type=\"radio\" id={\"v\" + index} name=\"choose\" />\r\n                  <label\r\n                    htmlFor={\"v\" + index}\r\n                    onClick={() => setCalculatedValue(coin.priceInTON)}\r\n                  >\r\n                    {coin.premiumAmount}DUR\r\n                  </label>\r\n                </>\r\n              ))}\r\n            </div>\r\n          </div>\r\n          {/* conversion */}\r\n          <div className=\"convert\">\r\n            <h2>\r\n              <I18nText path=\"conversion_rate\" />:\r\n            </h2>\r\n            <div className=\"list\">\r\n              <span>1 TON = 100 DUR</span>\r\n            </div>\r\n          </div>\r\n          {/* pay */}\r\n          <div className=\"pay\">\r\n            <h2>\r\n              <I18nText path=\"you_will_pay\" />:\r\n            </h2>\r\n            <div className=\"list\">\r\n              <span>{calculatedValue} TON</span>\r\n            </div>\r\n          </div>\r\n          <TransactionHistory />\r\n          {/* submit */}\r\n          <div className=\"bar_btn\">\r\n            <button\r\n              className=\"btn_submit\"\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              onClick={makeTransaction}\r\n            >\r\n              <I18nText path={isLoading ? \"await_btn\" : \"purchase_btn\"} />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n};\r\nexport default PageDeposit;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}